## Отчет по лабораторной работе №2

### 1) Утилиты резервного копирования

*Логический бэкап (pg_dump)* - это резервная копия, созданная на уровне SQL-запросов. \
Это означает, что вместо копирования физических файлов базы данных, \
логический бэкап генерирует набор SQL-команд, которые позволяют\
воссоздать структуру и содержимое базы данных.

Сценарии применения\
•	Перенос данных между различными версиями PostgreSQL или платформами.\
•	Резервное копирование одной базы данных (или её части, например, таблиц или схем).\
•	Создание выборочной копии (например, только схемы или только данные).\
•	Гибкость восстановления: можно восстановить отдельные объекты или изменить порядок восстановления.

Преимущества\
•	Подходит для переноса между различными версиями PostgreSQL или операционными системами.\
•	Возможность выборочного восстановления объектов.

*Физический бэкап (pd_basebackup)* — это метод резервного копирования,\
при котором производится прямое копирование бинарных файлов базы данных,\
включая файлы данных, журналы и индексные файлы. \
Это создание полной двоичной копии всех файлов, относящихся к кластеру базы данных.

Сценарии применения\
•	Настройка репликации: создание резервной копии для standby-сервера.\
•	Быстрое восстановление системы после сбоя.\
•	Point-In-Time Recovery (PITR): восстановление до определённой точки времени при наличии WAL-журналов.

Преимущества\
•	Полная копия кластера PostgreSQL, включая все базы данных.\
•	Подходит для быстрого восстановления.\
•	Возможность восстановления до любой точки времени при наличии архивированных WAL-журналов.

### 2) Создание резервной копии

Выполняем бэкапы бд:

<img width="690" alt="Снимок экрана 2025-04-11 в 20 36 59" src="https://github.com/user-attachments/assets/aa8ec31a-4cb2-403f-9ab0-9d5bfe5aad7a" />

-Fc – кастомный формат PostgreSQL, позволяет выборочно восстанавливать объекты,\
только схемы или данные например. Поддерживает восстановление с помощью pg_restore.

-Ft – формат архива tar, удобен для переносимости, так как создаёт единый файл,\
который можно легко переместить. Поддерживает восстановление с помощью pg_restore.

Дополнительные параметры:
  -s: Сохраняет только схему базы данных (без данных).\
  -a: Сохраняет только данные (без схемы).\
  -t: Сохраняет данные только из указанной таблицы.\
  -n: Сохраняет объекты из указанной схемы.

### 3) Частичное (выборочное) резервное копирование

Сохраняем схему test_schema из dbalex:


Сохраняем две таблицы из схемы public в базе dbbleg:


### 4) Восстановление из резервной копии

Создаем бд dbbleg_backup:


Восстанавливаем базу данных из файла dbbleg.sql:


Выводим таблицы из базы данных dbbleg, чтобы сравнить с бэкапом:


Таблицы из базы данных dbbleg_backup:


### 5) Автоматизация бэкапов с помощью cron

Создание скрипта для автоматического бэкапа бд dbbleg.\
Скрипт ниже создает бэкап базы данных dbbleg, и располагает файл с бэкапом \
в кастомном формате в директории /home/bleg/backup-scripts. \
Также, бэкапы что хронятся дольше 7и дней автоматически удаляются. Это называется ротация.


Настройка на автовыполнение скрипта каждую минуту:


### 6) Мониторинг состояния системы

Выполняем команду top:


•	PID: Идентификатор процесса PostgreSQL.\
•	USER: Пользователь, под которым запущен процесс (обычно postgres).\
•	%CPU: Процент использования CPU процессом.\
•	%MEM: Процент использования оперативной памяти процессом.\
•	TIME+: Общее время работы процесса на CPU.\
•	COMMAND: Имя команды или процесса (например, postgres: writer process).

Выполняем команду htop:


PID → Идентификатор процесса\
USER → Владелец процесса\
PRI → Приоритет процесса (чем ниже, тем важнее)\
NI → "Nice" уровень (чем ниже, тем больше процессу дают CPU)\
VIRT → Виртуальная память, используемая процессом\
RES → Реально используемая память (без swap)\
SHR → Разделяемая память (используемая совместно с другими процессами)\
S → Состояние (S – спит, R – работает, Z – зомби)\
%CPU → Использование CPU процессом\
%MEM → Использование памяти\
TIME+ → Время работы процесса\
COMMAND → Запущенная команда



### 7) Мониторинг PostgreSQL

Просмотр активных процессов:


Просмотр статистики по базам данных:


Завершение зависшего процесса:\
SELECT pg_terminate_backend(<pid>);

### 8) Логирование и анализ логов 

Вывод системных логов:

<img width="1013" alt="Снимок экрана 2025-04-11 в 22 03 56" src="https://github.com/user-attachments/assets/f33f307c-9716-4dee-b53c-deb1c05c8b15" />







